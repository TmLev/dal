version: '3'

services:
  postgres:
    image: postgres:12.4-alpine
    restart: always
    env_file:
      - .env.example

  dms:
    build: .
    depends_on:
      - postgres
    command: >
      sh -c "wait-for-it/wait-for-it.sh $POSTGRES_HOST:$POSTGRES_PORT -t 0 &&
             python manage.py makemigrations &&
             python manage.py migrate &&
             python manage.py runserver 0.0.0.0:$DMS_PORT"
    ports:
      - $DMS_PORT:$DMS_PORT
    volumes:
      - ./backend:/dms/backend
      - ./dms:/dms/dms
      - ./mil_lms_backend:/dms/mil_lms_backend
